{
    "collab_server" : "",
    "contents" : "---\ntitle: \"EDA with R\"\nsubtitle: Data Visualization with **ggplot** & **dplyr**\nauthor: \"Ling Hsu (Source from DSP Data Lab)\"\ndate: '2017.05.17'\noutput:\n  ioslides_presentation:\n    css: css/dsp.css\n    widescreen: yes\n    self_contained: false\n---\n\n```{r ,echo=FALSE,warning=FALSE,message=F}\noptions('scipen'=100,'digits'=2)\nknitr::opts_chunk$set(comment=\"\",prompt=F,strip.white=F,\n                      warning=FALSE,message=F,echo=T,\n                      fig.align='center',fig.height=3.5)\nlibrary(dplyr)\nlibrary(dygraphs)\nlibrary(ggplot2)\nlibrary(ggmap)\nlibrary(data.table)\nlibrary(devtools)\nlibrary(plotly)\nlibrary(xtable)\nlibrary(rCharts)\nlibrary(tidyr)\nlibrary(DT)\nlibrary(RColorBrewer)\nlibrary(dplyr)\n```\n\n# 課程綱要\n\n## Agenda \n\n- Data Visualization\n- `ggplot2` in R\n    * 基本架構介紹\n    * 起手式(基本語法)\n    * 應用(各種圖形的呈現)\n        + `Bar`\n        + `Line`\n        + `Histogram`\n        + `Boxplot`\n        + `point`\n    * 進階技巧\n- 互動式視覺化呈現\n\n\n## Data Visualization\n\n- 清晰有效地傳達與溝通訊息\n- 教學、研究、宣傳\n- 美學、功能兼顧\n- 統計圖形、訊息可視化\n\n## ggplot2簡介\n\n<div style='float:left;width:50%;'>\n- 套件下載次數第一名([Source](https://www.rdocumentation.org/trends?page1=1&sort1=direct&page2=1&sort2=total&page3=1&page4=1))\n- R環境下的繪圖套件\n- 取自 “The Grammar of Graphics” (Leland Wilkinson, 2005)\n- [設計理念](https://github.com/cosname/ggplot2-translation/blob/master/preface.md)\n    - 採用圖層系統\n    - 用抽象的概念來控制圖形，</br>\n      避免細節繁瑣\n    - 圖形美觀\n</div>   \n\n<div style='float:right;width:48%;'>\n<img src='/Users/hsiaoling/Desktop/Code/Program/R語言集訓班/img/most_download_in_R.png' width=420 align='center'></img>\n</div> \n\n## The Anatomy of a Plot \n\n<center>\n<img src='/Users/hsiaoling/Desktop/Code/Program/R語言集訓班/img/anatomy.png' width=750 align='center'></img>\n</center>\n\n## ggplot2基本架構\n\n- 資料 (data) 和映射 (mapping)\n- 幾何對象 (`geom`etric)\n- 座標尺度 (`scale`)\n- 統計轉換 (`stat`istics)\n- 座標系統 (`coord`inante)\n- 圖層 (layer)\n- 刻面 (`facet`)\n- 主題 (`theme`)\n\n## ggplot2基本架構(2)\n\n<center>\n<img src='/Users/hsiaoling/Desktop/Code/Program/R語言集訓班/img/ggplot.jpeg' width=550 align='center'></img>\n</br>\nsource: http://goo.gl/Odt2Rs\n</center>\n\n\n\n## ggplot2 基本語法 \n\n```{r echo=TRUE, eval=FALSE}\nggplot(data=..., aes(x=..., y=...)) + \n  geom_xxx(...) +\n  stat_xxx(...) + \n  facet_xxx(...) + ...\n```\n\n- `ggplot` 描述 data 從哪來\n- `aes` 描述圖上的元素跟 data 之類的對應關係\n- `geom_xxx` 描述要畫圖的類型及相關調整的參數\n- 常用的類型諸如：`geom_bar`, `geom_line`, `geom_points`, ...\n\n## Various functions\n\n```{r}\nlibrary(ggplot2)\n# list all geom\nls(pattern = '^geom_', env = as.environment('package:ggplot2'))\n```\n\n\n## **注意**\n\n- 使用 `data.frame` 儲存資料 (不可以丟 matrix 物件)\n- 使用 `long format` (利用reshape2將資料轉換成 1 row = 1 observation)\n\n</br>\n\n<center>![](/Users/hsiaoling/Desktop/Code/Program/R語言集訓班/img/wide-long.png)</center>\n\n## 馬上來個範例 {data-background=\"a.jpeg\"}\n\n```{r echo=TRUE,fig.width=6,fig.height=3,fig.align='center'}\n# 先定義一個資料表\ndata <- data.frame(身份 = c(\"大學部\",\"研究所\",\"教授\",\"講師\",\"助教\"), \n                   人數 = c(20,15,5,2,3))\n# plot\nggplot(data = data, aes(x = 身份, y = 人數)) + \n  geom_bar(stat = \"identity\") +\n  theme_grey(base_family = \"STHeiti\") \n```\n\n## 首先請先安裝以下套件\n\n- 安裝套件\n```{r echo=TRUE, eval=FALSE}\ninstall.packages(c(\"ggplot2\",\"dplyr\",\"reshape2\"),repos=\"http://cran.csie.ntu.edu.tw/\")\n```\n\n</br>\n\n- 載入套件\n```{r echo=TRUE, eval=FALSE}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(reshape2)\n```\n\n</br>\n\n**注意**：下載完套件一定要記得 `library` 才能使用喲！\n\n\n## 一切從讀檔開始（CSV）\n\n- [課程資料下載](https://ling32342.github.io/2017_NCCU_R/data/transaction.csv)\n```{r,eval=FALSE}\n############### 絕對路徑 ###############\n# 請輸入完整的檔案路徑\ndata <- read.csv(\"/Users/hsiaoling/Desktop/data/transaction.csv\") #如果你是mac\ndata <- read.csv(\"C:\\\\Users\\\\transaction.csv\") #如果你是windows\n\n############### 相對路徑 ###############\n# 瞭解現在我們所處在的路徑\ngetwd()\n# 設定我們檔案存放的路徑\nsetwd() \n# 讀檔起手式\ndata <- read.csv(\"transaction.csv\") \n# 若讀入的是亂碼，試試以下\ndata <- read.csv(\"transaction.csv\",fileEncoding = 'big5')  #如果你是mac\ndata <- read.csv(\"transaction.csv\",fileEncoding = 'utf-8') #如果你是windows\n```\n\n\n```{r,echo=FALSE}\ndata <- read.csv(\"/Users/hsiaoling/Desktop/Code/Program/R語言集訓班/data/transaction.csv\") %>% as.data.frame()\ndata <- data[,-1]\ndata$trac_month <- factor(data$trac_month)\n```\n\n## 資料介紹\n```{r, echo=FALSE}\nhead(data,5)\n```\n\n\n## 欄位說明\n\n```{r echo = FALSE,fig.height=3, warning=FALSE, fig.align='center', message=FALSE, results='asis'}\ndata.frame(英文欄位名稱=c(\"city\",\"district\",\"trac_year\",\"trac_month\",\"trac_type\",\"trac_content\",\n                   \"use_type\",\"build_type\",\"build_ymd\",\"area_land\",\"area_build\",\n                   \"area_park\",\"price_total\",\"price_unit\"),\n           中文欄位名稱=c(\"縣市\",\"鄉鎮市區\",\"交易年份\",\"交易月份\",\"交易標的\",\"交易筆棟數\",\"使用分區或編定\",\n                    \"建物型態\",\"建築完成年月\",\"土地移轉總面積.平方公尺.\",\"建物移轉總面積.平方公尺.\",\n                    \"車位移轉總面積.平方公尺.\",\"總價.元.\",\"單價.元.平方公尺.\")) -> name\n\n```\n\n<div style='float:left;width:48%;'>\n```{r, echo = FALSE}\nname[1:7,] %>% knitr::kable()\n```\n\n</div>\n\n<div style='float:right;width:50%;'>\n```{r, echo = FALSE}\nname[8:14,] -> name2\nrownames(name2) <- c(1:7)\nname2 %>% knitr::kable()\n```\n\n</div>\n\n\n## 以為開始了嗎？\n\n- 進行分析前，先去了解資料的型態與特性\n\n```{r echo=TRUE}\nstr(data)\n```\n\n## 身為資料分析師，一定要有的好習慣！\n\n- 暸解基本的各變數統計量值\n\n```{r echo=TRUE}\nsummary(data)\n```\n\n\n# Bar chart\n\n## Bar chart\n\n- `geom_bar`\n- 先來看看2013年在各縣市的案件交易量\n\n```{r,warning=FALSE,fig.height=3,fig.align='center', message=FALSE}\nthm <- function() theme(text=element_text(size = 15, family = \"STHeiti\")) # 控制字體與大小\n    # STHeiti是只有Mac才有的字體, 用來解決Mac系統中文顯示錯誤的問題\n    # Windows系統使用者請忽略 `+ thm()` 指令\ndata %>% \n  ggplot(aes(x=city)) + geom_bar(stat = \"count\") + thm() # stat = \"count\" 算個數\n```\n\n## Change labels!\n```{r,warning=FALSE,fig.height=3.5,fig.align='center', message=FALSE}\ndata %>% \n  ggplot(aes(x=city)) + geom_bar(stat = \"count\") + thm() +\n  labs(title=\"各縣市交易量\",x=\"縣市\",y=\"交易量\") # lab用來幫圖形的標題、x軸與y軸做命名\n```\n\n## Change colors!\n\n- 顏色調整：`color` vs `fill`?\n```{r,warning=FALSE,fig.height=3.5,fig.align='center', message=FALSE}\ndata %>% \n  ggplot(aes(x=city)) + geom_bar(stat = \"count\") + thm() +\n  labs(title=\"各縣市交易量\",x=\"縣市\",y=\"交易量\") +\n  geom_bar(fill='snow', color='black') # see colors() if you're picky\n```\n\n\n## Bar chart\n\n-  看臺北市各行政區的案件交易量\n```{r,warning=FALSE,fig.height=3.5,fig.align='center', message=FALSE}\n# 資料整理\ndata %>% \n  filter(city == \"臺北市\") %>% \n  group_by(district) %>% \n  summarise(amount=n()) -> table # dplyr::n 用來計數\n```\n\n```{r,echo=FALSE}\ntable\n```\n\n\n## Bar chart\n\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ntable %>% \n  ggplot(aes(x=district,y=amount)) +\n  geom_bar(stat = \"identity\") + thm() # stat='identity'以表格的值做為bar的高度\n```\n\n\n## Reoder x\n```{r ,warning=FALSE,fig.align='center', message=FALSE}\ntable %>% \n  ggplot(aes(x=reorder(district,-amount), y=amount)) +\n  geom_bar(stat='identity') + thm() +\n  labs(titles = \"臺北市各行政區交易量\", x = \"行政區\", y = \"案件數\")\n```\n\n\n## 小挑戰\n\n- 計算臺北市&高雄市的各使用分區或編定(`use_type`)所佔比例\n\n```{r,echo=FALSE}\ndata %>% \n  filter(city == \"臺北市\" | city == \"高雄市\" ) %>% \n  group_by(city,use_type) %>% \n  summarise(amount = n()) %>% \n  mutate(rate = round(amount/sum(amount),3) ) -> table\ntable\n```\n\n\n## 參考解答\n\n```{r, eval=FALSE}\ndata %>% \n  filter(city == \"臺北市\" | city == \"高雄市\" ) %>% \n  group_by(city,use_type) %>% \n  summarise(amount = n()) %>% \n  mutate(rate = round(amount/sum(amount),2) ) -> table\n```\n\n\n## Grouping：`stack`\n```{r,warning=FALSE,fig.align='center', message=FALSE,fig.height=4}\ntable %>% \n  ggplot(aes(x = city, y = rate, fill = use_type)) +\n  geom_bar(stat = 'identity', position = 'stack') + thm() # stack類別堆疊\n```\n\n## Grouping：`dodge`\n```{r,warning=FALSE,fig.align='center', message=FALSE,fig.height=4}\ntable %>% \n  ggplot(aes(x = city, y = rate, fill = use_type)) +\n  geom_bar(stat = 'identity', position = 'dodge')  + # dodge類別並排\n  thm() + scale_fill_discrete(name  =\"使用分區或編定\")  # 設定圖例的顯示\n```\n\n# Line chart\n\n## Line chart\n\n- `geom_line`\n- 各月份交易量\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ndata %>% \n  group_by(trac_month) %>% \n  summarise(amount=n()) -> table\ntable\n```\n\n## Line chart\n\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ntable %>% \n  ggplot(aes(x=trac_month,y=amount,group=1)) +\n  geom_line() + thm() + labs(x = \"交易月份\" , y = \"交易數量\")\n```\n\n## `Multiple` Line\n\n- 各縣市各月份交易量比較\n\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ndata %>% \n  group_by(city,trac_month) %>% \n  summarise(amount=n()) -> table\ntable\n```\n\n## `Multiple` Line\n\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ntable %>% \n  ggplot(aes(x=trac_month,y=amount,group=city,color=city)) +\n  geom_line() + geom_point() + thm() + \n  labs(x = \"交易月份\" , y = \"交易數量\")\n```\n\n\n# Histogram\n\n## Histogram\n\n- `geom_histogram`\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ndata %>% \n  ggplot(aes(x=age, y =..count..)) + \n  geom_histogram()\n```\n\n## Histogram\n\n- `aes(y=..count..)` vs. `aes(y=..density..)`\n\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ndata %>% \n  ggplot(aes(x=age, y =..density..)) + \n  geom_histogram()\n```\n\n## Histogram\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ndata %>% \n  ggplot(aes(x=age, y =..density.., fill =..count..)) + # fill 依指定欄位填色\n  geom_histogram(binwidth=.5) \n```\n\n## Histogram + density\n\n- `geom_histogram()` + `geom_density()`\n\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ndata %>% \n  ggplot(aes(x=age,y=..density..)) + \n  geom_histogram(color=\"black\", fill=\"white\") +\n  geom_density(alpha=.2, fill=\"#FF6666\") # alpha設定透明度\n```\n\n# Boxplot \n\n## Boxplot \n\n- `geom_boxplot`\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ndata %>% \n  ggplot(aes(x=city,y=price_unit)) + \n  geom_boxplot() + thm() + \n  labs(x = \"縣市\" , y = \"每平方公尺價格(元)\")\n```\n\n## Change `limits` of axes!\n\n```{r,warning=FALSE,fig.align='center', message=FALSE}\ndata %>% \n  ggplot(aes(x=city,y=price_unit)) + \n  geom_boxplot() + thm() + \n  labs(x = \"縣市\" , y = \"每平方公尺價格(元)\") + \n  coord_cartesian(ylim = c(0, 2000000)) # 設定y軸上下界線\n```\n\n## Boxplot \n```{r,warning=FALSE,fig.align='center', message=FALSE}\ndata %>% \n  ggplot(aes(x=city,y=log(price_unit))) + \n  geom_boxplot() + thm() + # geom_boxplot(outlier.shape = NA) outlier不顯示\n  labs(x = \"縣市\" , y = \"log(每平方公尺價格(元))\")\n```\n\n# Scatter plot\n\n## Scatter plot\n\n- `geom_point`\n```{r,warning=FALSE,fig.align='center', message=FALSE}\niris %>% \n  ggplot(aes(x=Sepal.Length, y=Petal.Length, color=Species)) + \n  geom_point(shape=1, size=2) # shape控制圖示；size控制點的大小\n```\n\n## point shape types in `ggplot2`\n\n<center><img src='/Users/hsiaoling/Desktop/Code/Program/R語言集訓班/img/point_shape_types.png' style='height: 500px' align=\"middle\"></img></center>\n\n## Scatter plot\n\n- 參數放在aes()函數裡面，表示資料依據指定欄位內容做不同的shape/size變化\n```{r,warning=FALSE,fig.align='center', message=FALSE}\niris %>% \n  ggplot(aes(x=Sepal.Length, y=Petal.Length, \n             color=Species, shape = Species, size = Species)) + geom_point() +\n  scale_shape_manual(values=c(1,5,7)) +  # 控制 shape 顯示圖示\n  scale_size_manual(values=c(1,2,3))   # 控制圖示 size 顯示大小\n```\n\n# 進階技巧\n\n## `stat`istics\n\n- Fit regression line\n```{r}\niris %>% \n  ggplot(aes(x = Sepal.Length, y = Petal.Length)) + \n  geom_point() +\n  stat_smooth(method=lm, level=.95) # add se=FALSE to disable CI\n```\n\n## `facet`\n\n- 比較各縣市在各月份下的交易量\n\n```{r echo = TRUE,fig.height=3.2}\ndata %>% \n  group_by(city,trac_month) %>% # 選擇縣市、交易月份作為分群\n  summarise(total = n()) -> table # 計算分群下的總數\ntable %>% \n  ggplot(aes(x = trac_month, y = total ,fill = city))+\n    geom_bar(stat='identity') + thm()\n```\n\n## `facet`\n\n```{r }\ntable %>% \n  ggplot(aes(x = trac_month, y = total ,fill = city))+\n    geom_bar(stat='identity') + thm() +\n    facet_wrap( ~city , nrow = 2) +\n    labs(x = \"交易月份\" ,y=\"交易量\")\n```\n\n## `coord`_flip()\n\n```{r}\ntable %>% \n  ggplot(aes(x = trac_month, y = total ,fill = city))+\n    geom_bar(stat='identity') + thm() +\n    facet_wrap( ~ city , nrow = 2) +\n    labs(x = \"交易月份\" ,y=\"交易量\") +\n    coord_flip() \n```\n\n\n## 圖形輸出\n\n- 利用RStudio UI介面存擋\n- 畫完圖之後，再存檔~~\n\n```{r echo=TRUE,eval=FALSE}\nggsave('檔案名稱')\nggsave(\"plot.pdf\", width = 4, height = 4)\nggsave(\"plot.png\", width = 4, height = 4, dpi = 300)\n```\n\n# 互動式視覺化呈現\n\n## package：`Plotly`\n\n- Plotly是一個資料視覺化的R套件，以簡單的方式，讓資料能夠產生互動的效果。\n- 提供一個合作平台，使用者能夠將自己在R中繪製的圖存上屬於自己的Plotly平台上。\n- [Plotly官方網站](https://plot.ly/)\n- 結合了各式各樣的API，包裝`Python`、`R`、`Malab`、...等等\n\n>- 當然～ggplot2也能夠輕易地使用plotly轉換成互動式的圖表！！\n\n## 套件安裝\n\n- 直接從`CRAN`內下載\n\n```{r echo=TRUE,eval=FALSE}\n# Plotly is now on CRAN!\ninstall.packages(\"plotly\")\n# install the latest development version (on GitHub) via devtools\n```\n\n- `或是`從`github`上下載，但前提是`先`安裝`devtools`\n\n```{r echo=TRUE,eval=FALSE}\n# install.packages(\"devtools\")\ndevtools::install_github(\"ropensci/plotly\")\n```\n\n</br>\n\n- 安裝完，一樣別忘了要`library`！\n```{r}\nlibrary(plotly)\n```\n\n## plot with `ggplot2`\n\n- 先將要畫的圖存成一個物件\n```{r ,warning=FALSE,fig.align='center', message=FALSE}\niris %>% \n  ggplot(aes(Petal.Width, Sepal.Length, colour=Species)) +\n    geom_point() -> a\na\n```\n\n## plot with `ggplotly`\n\n```{r,warning=FALSE,fig.align='center', message=FALSE, fig.height=5}\nggplotly(a)\n```\n\n\n## 學習資源\n\n- [ggplot2 cheat sheet from RStudio Inc.](http://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)\n\n- [Graphs with ggplot2](http://www.cookbook-r.com/Graphs/)\n\n- [ggplot2 官方文件](http://docs.ggplot2.org/current/index.html)\n\n- [Rcolorbrewer調色盤](http://docs.ggplot2.org/current/scale_brewer.html)\n\n- [Plotly ggplot2 Library](https://plot.ly/ggplot2/)\n\n- [highcharter套件介紹](http://jkunst.com/highcharter/oldindex.html#shiny-integration)\n\n\n## 掌握心法後，如何自行利用R解決問題\n\n- 了解自己的需求，詢問關鍵字與函數\n\n- [Taiwan R User Group](http://www.meetup.com/Taiwan-R)\n\n- [ptt R_Language版](https://www.ptt.cc/bbs/R_Language/index.html)\n\n- [R軟體使用者論壇](https://groups.google.com/forum/#!forum/taiwanruser)\n\n- [StackOverflow](http://stackoverflow.com/) \n\n- 歡迎來信 <ling32342@gmail.com> 與我一起交流！\n\n",
    "created" : 1495444487965.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3938397310",
    "id" : "718975C2",
    "lastKnownWriteTime" : 1495458045,
    "last_content_update" : 1495458045304,
    "path" : "/Volumes/SD-Lofu/2017_NCCU_R-gh-pages/RDataVisualization.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}